

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Continuous integration of firmware &mdash; nRF Asset Tracker 66417cb09c1157f09d9e4092ab799963a244afed documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/common.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Firmware for the Azure cloud components" href="../firmware/azure/Index.html" />
    <link rel="prev" title="Building the project using GitHub actions" href="../firmware/aws/BuildingUsingGitHub.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> nRF Asset Tracker
          

          
          </a>

          
            
            
              <div class="version">
                saga
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../project/Index.html">Project overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GettingStarted.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="Index.html">AWS cloud components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure/Index.html">Azure cloud components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../app/Index.html">nRF Asset Tracker web application</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../firmware/Index.html">Firmware</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../firmware/aws/Index.html">Firmware for the AWS cloud components</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../firmware/aws/BuildingUsingLocalSystem.html">Building the project using your local system</a></li>
<li class="toctree-l3"><a class="reference internal" href="../firmware/aws/BuildingUsingDocker.html">Building the project using Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../firmware/aws/BuildingUsingGitHub.html">Building the project using GitHub actions</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Continuous integration of firmware</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../firmware/azure/Index.html">Firmware for the Azure cloud components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../firmware/Programming.html">Programming the firmware</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../devices/Index.html">Connect using a real device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cloud-protocol/Index.html">Device-to-cloud communication</a></li>
</ul>
<p class="caption"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../guides/Index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/search?q=org%3ANordicSemiconductor+nrf-asset-tracker&amp;type=repositories">GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CODE_OF_CONDUCT.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CONTRIBUTING.html">Contributing to the project</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">nRF Asset Tracker</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../firmware/Index.html">Firmware</a> &raquo;</li>
        
          <li><a href="../firmware/aws/Index.html">Firmware for the AWS cloud components</a> &raquo;</li>
        
      <li>Continuous integration of firmware</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/NordicSemiconductor/asset-tracker-cloud-docs/blob/saga/docs/aws/FirmwareContinuousIntegration.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="continuous-integration-of-firmware">
<span id="aws-firmware-ci"></span><h1>Continuous integration of firmware<a class="headerlink" href="#continuous-integration-of-firmware" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id1">Overview</a></li>
<li><a class="reference internal" href="#preparation" id="id2">Preparation</a></li>
<li><a class="reference internal" href="#firmware-ci-runner-setup" id="id3">Firmware CI runner setup</a></li>
</ul>
</div>
<p>The AWS implementation of the nRF Asset Tracker provides the resources for continuous testing of the firmware using real hardware.</p>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id1">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Every commit to the <a class="reference external" href="https://github.com/NordicSemiconductor/asset-tracker-cloud-firmware-aws">firmware repository</a> will trigger a CI run.
The CI run results in the following actions:</p>
<ol class="arabic simple">
<li>Creating a new device and credentials on AWS IoT.</li>
<li>Building a firmware that has the device ID hardcoded for the MQTT client ID.</li>
<li>Scheduling a run on a self-hosted GitHub Actions runner. See <a class="reference internal" href="#aws-firmware-ci-runner-setup"><span class="std std-ref">Firmware CI runner setup</span></a>.</li>
<li>Observing the firmware CI run until completion.</li>
<li>Running assertions against the log result.</li>
</ol>
<p>The Firmware CI runner is running on a PC connected to GitHub Actions, where it receives the jobs to execute.
The Firmware CI runner performs the following actions:</p>
<ol class="arabic simple">
<li>Programming the firmware and the optional credentials using the connected debugger to the connected nRF9160 DK or Thingy:91.</li>
<li>Logging all output until one of the following conditions occur:<ul>
<li>A timeout is reached</li>
<li>A stop condition is reached. (Wait for a log output to match a string.)</li>
</ul>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These devices connect to the existing instance of the nRF Asset Tracker, so the firmware tests will not set up a new empty nRF Asset Tracker AWS environment for every test.
The test runs against the production environment.
This is to ensure that the firmware release will work with the existing solution.
This approach is designed for <a class="reference external" href="https://thinkinglabs.io/talks/feature-branching-considered-evil.html">trunk-based development</a>.</p>
</div>
</div>
<div class="section" id="preparation">
<h2><a class="toc-backref" href="#id2">Preparation</a><a class="headerlink" href="#preparation" title="Permalink to this headline">¶</a></h2>
<p>Enable the Firmware CI resources of the nRF Asset Tracker that allow GitHub Actions to create test devices.
Also enable the Firmware CI runner to connect before deploying the stack (see <a class="reference internal" href="GettingStarted/Index.html#aws-getting-started"><span class="std std-ref">Getting Started</span></a>).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>node cli configure context stack firmware-ci <span class="m">1</span>
npx cdk deploy --all
</pre></div>
</div>
<p>Print the AWS Key for the CI runner on GitHub Actions using the following command:</p>
<pre class="highlight literal-block">
node cli firmware-ci -s

Region: &quot;<em>Region</em>&quot;
Bucket name: &quot;<em>Bucket name</em>&quot;
Access Key ID: &quot;<em>AWS Access Key ID</em>&quot;
Secret Access Key: &quot;<em>AWS Secret Access Key</em>&quot;
</pre>
<p>Configure the following parameters as secrets on the firmware GitHub repository:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">AWS_ACCESS_KEY_ID</span></code> (as printed above)</li>
<li><code class="docutils literal notranslate"><span class="pre">AWS_SECRET_ACCESS_KEY</span></code> (as printed above)</li>
<li><code class="docutils literal notranslate"><span class="pre">AWS_REGION</span></code> (as printed above)</li>
<li><code class="docutils literal notranslate"><span class="pre">STACK_NAME</span></code> (the stack name of your production environment, usually <code class="docutils literal notranslate"><span class="pre">nrf-asset-tracker</span></code>)</li>
</ul>
</div>
<div class="section" id="firmware-ci-runner-setup">
<span id="aws-firmware-ci-runner-setup"></span><h2><a class="toc-backref" href="#id3">Firmware CI runner setup</a><a class="headerlink" href="#firmware-ci-runner-setup" title="Permalink to this headline">¶</a></h2>
<p>To set up the Firmware CI runner, complete the following steps:</p>
<ol class="arabic simple">
<li>Prepare an environment that fulfills the <a class="reference internal" href="../project/SystemRequirements.html#system-requirements"><span class="std std-ref">necessary system requirements</span></a>.</li>
<li>Download <a class="reference external" href="https://www.segger.com/downloads/jlink/">JLink</a> for your platform, and ensure that <code class="file docutils literal notranslate"><span class="pre">JLinkExe</span></code> is in your path.</li>
<li>Follow <a class="reference external" href="https://docs.github.com/en/actions/hosting-your-own-runners/about-self-hosted-runners">the instruction about self-hosted runners</a> to set up a runner for your firmware repository.
Make sure to use <code class="docutils literal notranslate"><span class="pre">firmware-ci</span></code> when prompted for the labels.</li>
</ol>
<p>The Firmware CI starts to process all the scheduled jobs one after another.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../firmware/azure/Index.html" class="btn btn-neutral float-right" title="Firmware for the Azure cloud components" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../firmware/aws/BuildingUsingGitHub.html" class="btn btn-neutral float-left" title="Building the project using GitHub actions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019-2022, Nordic Semiconductor ASA | nordicsemi.no

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>